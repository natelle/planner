<%- include ../header.ejs %>

<h2><%= __("agenda.default") %></h2>
<br>

<% for(var categoryId in slots) { %>
<h4><%= categories[categoryId] ? categories[categoryId].name : __("category.default") %></h4>
<br>
<table class="table table-sm">
    <thead>
        <tr>
            <th scope="col"><%= __("availability.day") %></th>
            <th scope="col" class="text-center"><%= __("availability.slot") %></th>
        </tr>
    </thead>
    <tbody>
        <% for(var i=1; i<=7; i++) { %>
            <% var day = i % 7; %>
            <tr>
                <th scope="row"><%= __("time.day" + day) %></th>
                <td class="type text-center">
                    <% if(typeof slots[categoryId][day] !== 'undefined') { %>
                        <div class="btn-group" role="group">
                            <% for(var slot of slots[categoryId][day]) { %>
                                <button type="button" class="btn btn-secondary btn-sm slot" data-day="<%= day %>" data-slotId="<%= slot.id %>"><%= slot.name %></button>
                            <% } %>
                        </div>
                    <% } %>
                </td>
            </tr>
        <% } %>
    </tbody>
</table>
<br>
<% } %>

            <script>
            $(document).ready(function() {
                $('button.slot').each(function() {
                    var day = $(this).attr("data-day");
                    var slotId = $(this).attr("data-slotId");
                    var that = this;
                    $.post('/agenda/default/enabled', {
                        slotId: slotId,
                        day: day
                    }, function(enabled) {
                        $(that).removeClass("btn-secondary");

                        if(enabled) {
                            $(that).removeClass("btn-danger");
                            $(that).addClass("btn-success");
                        } else {
                            $(that).removeClass("btn-success");
                            $(that).addClass("btn-danger");
                        }
                    })
                });

                $('button.slot').click(function() {
                    var enable = !$(this).hasClass("btn-success");
                    var day = $(this).attr("data-day");
                    var slotId = $(this).attr("data-slotId");
                    var that = this;

                    $(this).addClass("disabled");

                    if(enable) {
                        $(this).removeClass("btn-danger");
                        $(this).addClass("btn-success")
                    } else {
                        $(this).removeClass("btn-success");
                        $(this).addClass("btn-danger")
                    }

                    $.post('/agenda/default/set', {
                        enable: enable,
                        slotId: slotId,
                        day: day
                    },
                    function(enabled) {
                        $(that).removeClass("disabled");

                        if(enabled) {
                            $(this).removeClass("btn-danger");
                            $(this).addClass("btn-success")
                        } else {
                            $(this).removeClass("btn-success");
                            $(this).addClass("btn-danger")
                        }
                    });
                });
            });
            </script>

            <%- include ../footer.ejs %>
