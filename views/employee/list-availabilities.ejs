<%- include ../header.ejs %>

<h2>Disponibilit√©s de <%= employee.firstName %> <%= employee.lastName %></h2>
<br>
<%var currentMonth = availabilities[0].day;%>
<p>
    <a class="btn btn-primary" href="/employee/<%= employee.id %>/availabilities/<%= currentMonth.getFullYear() %>" role="button">Retour</a>
</p>
<br>
<div class="row">
    <div class="col-md-1">
        <%
        var previousMonth = new Date(availabilities[0].day);
        previousMonth.setMonth(previousMonth.getMonth()-1);
        %>
        <a href="/employee/<%= employee.id %>/availabilities/<%= (previousMonth.getMonth() + 1).toString().padStart(2, '0') + previousMonth.getFullYear() %>" role="button"><i class="fas fa-arrow-circle-left fa-2x"></i></a>
    </div>
    <div class="col-md-10">
        <table class="table table-sm">
            <thead>
                <tr>
                    <th scope="col"><%= __("availability.date") %></th>
                    <th scope="col" class="text-center"><%= __("availability.type") %></th>
                </tr>
            </thead>
            <tbody>
                <% for(var i in availabilities) {%>
                    <%var availability = availabilities[i];%>
                    <%var date = availability.day;%>
                    <% var dateId = date.getFullYear() + '-' + (date.getMonth()+1).toString().padStart(2, '0') + '-' + date.getDate().toString().padStart(2, '0') %>

                    <tr class="presenceRow" id="row<%= dateId %>" data-dateId="<%= dateId %>">
                    <th scope="row" class="date">
                    <%= date.getDate().toString().padStart(2, '0') + '/' + (date.getMonth()+1).toString().padStart(2, '0') + '/' + date.getFullYear() %>
                    </th>
                    <td class="type text-center" data-type="<%= availability.type %>" data-dateId="<%= dateId %>">
                    <%= __(availability.type) %>
                    </td>
                    </tr>
                    <% } %>
                </tbody>
            </table>
        </div>
        <div class="col-md-1">
            <%
            var nextMonth = new Date(availabilities[0].day);
            nextMonth.setMonth(nextMonth.getMonth()+2);
            %>
            <a href="/employee/<%= employee.id %>/availabilities/<%= nextMonth.getMonth().toString().padStart(2, '0') + nextMonth.getFullYear() %>" role="button"><i class="fas fa-arrow-circle-right fa-2x"></i></a>
        </div>
    </div>

    <script>
    $(document).ready(function() {
        var typeOrder = ['time.allday', 'time.morning', 'time.afternoon', 'time.closed'];
        var typeTranslations = {
            'time.allday': "<%= __("time.allday") %>",
            'time.morning': "<%= __("time.morning") %>",
            'time.afternoon': "<%= __("time.afternoon") %>",
            'time.closed': "<%= __("time.closed") %>" %>
        };

        $('td.type').click(function() {
            var index = typeOrder.indexOf($(this).attr("data-type"));
            var nextIndex = (index + 1) % typeOrder.length;
            var value = typeOrder[nextIndex];
            var dateId = $(this).attr("data-dateId");
            var that = this;

            $.post('/employee/<%= employee.id %>/availabilities/type/set',
            { dateId: dateId, value: value },
            function(data) {
                $(that).attr("data-type", value);
                $(that).text(typeTranslations[value]);
            });
        });
    });
</script>

<%- include ../footer.ejs %>
